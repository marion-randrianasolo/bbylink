---
alwaysApply: true
---

# BabyLink - Architecture Technique ComplÃ¨te

## ğŸ—ï¸ Architecture du SystÃ¨me

### **Dual Architecture**: Frontend NextJS + Backend Flask IoT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND      â”‚    â”‚   BACKEND       â”‚    â”‚   HARDWARE      â”‚
â”‚   Next.js 15    â”‚â—„â”€â”€â–ºâ”‚   Flask 5000    â”‚â—„â”€â”€â–ºâ”‚   Arduino       â”‚
â”‚   Port 3000     â”‚    â”‚   Socket.io     â”‚    â”‚   Sensors       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ƒï¸ Base de DonnÃ©es - SQLite avec Prisma

### **Schema Principal** (`frontend/prisma/schema.prisma`)
```sql
-- Table User (seule table actuelle)
CREATE TABLE "User" (
    "id" INTEGER PRIMARY KEY AUTOINCREMENT,
    "email" TEXT UNIQUE NOT NULL,
    "name" TEXT NOT NULL, 
    "password" TEXT NOT NULL,  -- SHA256 hash
    "score" INTEGER DEFAULT 0,
    "createdAt" DATETIME DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL
);
```

### **Configuration Prisma**
- **Provider**: SQLite (`frontend/prisma/dev.db`)
- **Client Output**: `frontend/src/generated/prisma`
- **Seed**: `frontend/prisma/seed.ts` (4 utilisateurs test)
- **Migrations**: `frontend/prisma/migrations/`

### **DonnÃ©es de Test** (Mot de passe: `test123`)
- messi@epsi.fr (2450 pts)
- ronaldo@epsi.fr (1890 pts) 
- neymar@epsi.fr (1650 pts)
- mbappe@epsi.fr (1200 pts)

## ğŸ¯ Frontend - Next.js 15 Architecture

### **Structure de Fichiers**
```
frontend/src/
â”œâ”€â”€ app/                 # App Router Next.js 15
â”‚   â”œâ”€â”€ api/auth/       # API Routes (login/register)
â”‚   â”œâ”€â”€ login/          # Page de connexion
â”‚   â”œâ”€â”€ page.tsx        # Dashboard principal
â”‚   â”œâ”€â”€ layout.tsx      # Layout racine + fonts
â”‚   â””â”€â”€ globals.css     # Styles globaux + variables CSS
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/            # Composants Shadcn/ui base
â”‚   â”œâ”€â”€ layout/        # Sidebar, AuthenticatedLayout
â”‚   â””â”€â”€ babyfoot_component/ # Composants mÃ©tier
â”œâ”€â”€ contexts/          # AuthContext (localStorage)
â””â”€â”€ lib/              # Utilities (Prisma, utils)
```

### **Stack Technique Frontend**
- **Framework**: Next.js 15.3.5 + App Router
- **Language**: TypeScript strict
- **Styling**: Tailwind CSS 4 + CSS Modules
- **Fonts**: IBM Plex Sans (Google) + NuberNext/Monument (local)
- **State**: React Context + localStorage
- **UI Components**: Radix UI + Lucide React icons
- **Animation**: Framer Motion
- **Database ORM**: Prisma Client

### **Authentification**
```typescript
// Structure User interface
interface User {
  id: number
  email: string
  name: string
  score: number
  // Futurs champs pour profil complet:
  firstName?: string
  lastName?: string
  avatar?: string
  jerseyNumber?: number
  skillLevel?: string
  position?: string
  championship?: string
  xp?: number
  coins?: number
  elo?: number
}
```

### **API Routes Next.js**
- **POST `/api/auth/login`**: Authentification SHA256
- **POST `/api/auth/register`**: Inscription utilisateur
- Futur: `/api/games`, `/api/rankings`, `/api/players`

## âš™ï¸ Backend IoT - Flask + Arduino

### **Flask Server** (`app/app.py`)
- **Port**: 5000
- **WebSocket**: Socket.io pour temps rÃ©el
- **Serial**: Communication Arduino via `/dev/ttyACM0`
- **Routes**: 
  - `GET /`: Interface HTML score
  - `POST /reset`: Reset scores
  - `WebSocket 'connect'`: Sync score initial

### **Score Management**
```python
score = {'GAUCHE': 0, 'DROITE': 0}  # Ã‰tat global

def emit_score():
    socketio.emit('score_update', {
        'left': score['GAUCHE'],
        'right': score['DROITE']
    })
```

### **Arduino Code** (`arduino/babylink/babylink.ino`)
- **Pins**: 2 (gauche), 3 (droite), 5 (buzzer)
- **Logic**: INPUT_PULLUP, dÃ©tection LOWâ†’HIGH
- **Serial**: 9600 baud, envoi "GAUCHE"/"DROITE"
- **Sound**: Buzzer 1000Hz, 150ms

### **Hardware Setup**
- Capteurs IR Adafruit
- Arduino Uno/Nano
- Buzzer actif
- Raspberry Pi (serveur Flask)

## ğŸ¨ Design System

### **Palette de Couleurs**
```css
:root {
  --primary-dark: #0C0E14;    /* Background principal */
  --accent-red: #EA1846;      /* CTA, highlights */
  --text-white: #FDFFFF;      /* Texte principal */
  --light-bg: #F7F7F7;        /* Backgrounds secondaires */
}
```

### **Fonts CSS Variables**
```css
--font-ibm-plex-sans: 'IBM Plex Sans', sans-serif;
--font-nubernext: 'NuberNext', sans-serif;  
--font-monument: 'Monument Extended', sans-serif;
```

### **Layout Responsive**
- **Desktop**: Sidebar 280px fixe + main content
- **Mobile**: Sidebar overlay + burger menu
- **CSS Grid**: `grid-rows-[auto_1fr_auto]` pour footer fixe

## ğŸš€ Scripts & Commandes

### **Frontend (Node.js)**
```bash
cd frontend/
npm run dev          # Dev server (port 3000)
npm run build        # Production build
npm run lint         # ESLint
npx prisma db push   # Sync schema â†’ database
npx prisma db seed   # Populate test data
npx prisma generate  # Generate client types
```

### **Backend IoT (Python)**
```bash
cd app/
python3 app.py       # Flask server (port 5000)
# PrÃ©requis: Arduino connectÃ© sur /dev/ttyACM0
```

## ğŸ”§ Configuration Files

### **Dependencies Management**
- **Frontend**: `frontend/package.json` (48 dÃ©pendances)
- **Backend**: `requirements.txt` (4 dÃ©pendances Python)

### **TypeScript Config**
- `frontend/tsconfig.json`: Strict mode, path mapping
- **ESLint**: `frontend/eslint.config.mjs` + `.eslintignore`

### **Tailwind Setup**
- `frontend/tailwind.config.ts`: CSS variables, fonts
- `frontend/postcss.config.mjs`: PostCSS 4

## ğŸ“¡ Real-time Communication

### **Socket.io Flow**
```
Arduino â†’ Serial â†’ Flask â†’ Socket.io â†’ Frontend
  â†“          â†“        â†“         â†“         â†“
"GAUCHE"  â†’  +1   â†’  emit   â†’  event  â†’  UI update
```

### **Event Types**
- `score_update`: Envoi score temps rÃ©el
- `connect`: Client connection (sync initial)

## ğŸ”’ Security & Auth

### **Password Hashing**
```typescript
// MÃªme logique partout (seed, login, register)
function hashPassword(password: string): string {
  return createHash('sha256').update(password).digest('hex')
}
```

### **Session Management**
- **Storage**: localStorage (frontend only)
- **Validation**: API routes vÃ©rifient hash
- **Redirect**: Auto-redirect si non connectÃ©

## ğŸ¯ Features Actuelles vs Futures

### **âœ… ImplÃ©mentÃ©**
- Authentification utilisateur
- Dashboard responsive  
- Sidebar navigation
- Score temps rÃ©el Arduinoâ†’Flask
- Design system complet

### **ğŸš§ En DÃ©veloppement**
- Profils utilisateur complets
- SystÃ¨me de matchs
- Rankings/Classements
- RÃ©servation tables
- SystÃ¨me de coins/paris
- Clans/Ã©quipes

## ğŸ“± Responsive Design

### **Breakpoints**
- `lg:`: Desktop (1024px+) - Sidebar fixe
- `max-lg:`: Mobile/Tablet - Sidebar overlay

### **Layout Strategy**
- **CSS Grid**: Layout principal
- **Flexbox**: Composants internes
- **Tailwind**: Utility-first approach

Cette architecture permet une Ã©volutivitÃ© maximale vers les fonctionnalitÃ©s futures tout en maintenant une base solide IoT + Web.
# BabyLink - Architecture Technique ComplÃ¨te

## ğŸ—ï¸ Architecture du SystÃ¨me

### **Dual Architecture**: Frontend NextJS + Backend Flask IoT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND      â”‚    â”‚   BACKEND       â”‚    â”‚   HARDWARE      â”‚
â”‚   Next.js 15    â”‚â—„â”€â”€â–ºâ”‚   Flask 5000    â”‚â—„â”€â”€â–ºâ”‚   Arduino       â”‚
â”‚   Port 3000     â”‚    â”‚   Socket.io     â”‚    â”‚   Sensors       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ƒï¸ Base de DonnÃ©es - SQLite avec Prisma

### **Schema Principal** (`frontend/prisma/schema.prisma`)
```sql
-- Table User (seule table actuelle)
CREATE TABLE "User" (
    "id" INTEGER PRIMARY KEY AUTOINCREMENT,
    "email" TEXT UNIQUE NOT NULL,
    "name" TEXT NOT NULL, 
    "password" TEXT NOT NULL,  -- SHA256 hash
    "score" INTEGER DEFAULT 0,
    "createdAt" DATETIME DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL
);
```

### **Configuration Prisma**
- **Provider**: SQLite (`frontend/prisma/dev.db`)
- **Client Output**: `frontend/src/generated/prisma`
- **Seed**: `frontend/prisma/seed.ts` (4 utilisateurs test)
- **Migrations**: `frontend/prisma/migrations/`

### **DonnÃ©es de Test** (Mot de passe: `test123`)
- messi@epsi.fr (2450 pts)
- ronaldo@epsi.fr (1890 pts) 
- neymar@epsi.fr (1650 pts)
- mbappe@epsi.fr (1200 pts)

## ğŸ¯ Frontend - Next.js 15 Architecture

### **Structure de Fichiers**
```
frontend/src/
â”œâ”€â”€ app/                 # App Router Next.js 15
â”‚   â”œâ”€â”€ api/auth/       # API Routes (login/register)
â”‚   â”œâ”€â”€ login/          # Page de connexion
â”‚   â”œâ”€â”€ page.tsx        # Dashboard principal
â”‚   â”œâ”€â”€ layout.tsx      # Layout racine + fonts
â”‚   â””â”€â”€ globals.css     # Styles globaux + variables CSS
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/            # Composants Shadcn/ui base
â”‚   â”œâ”€â”€ layout/        # Sidebar, AuthenticatedLayout
â”‚   â””â”€â”€ babyfoot_component/ # Composants mÃ©tier
â”œâ”€â”€ contexts/          # AuthContext (localStorage)
â””â”€â”€ lib/              # Utilities (Prisma, utils)
```

### **Stack Technique Frontend**
- **Framework**: Next.js 15.3.5 + App Router
- **Language**: TypeScript strict
- **Styling**: Tailwind CSS 4 + CSS Modules
- **Fonts**: IBM Plex Sans (Google) + NuberNext/Monument (local)
- **State**: React Context + localStorage
- **UI Components**: Radix UI + Lucide React icons
- **Animation**: Framer Motion
- **Database ORM**: Prisma Client

### **Authentification**
```typescript
// Structure User interface
interface User {
  id: number
  email: string
  name: string
  score: number
  // Futurs champs pour profil complet:
  firstName?: string
  lastName?: string
  avatar?: string
  jerseyNumber?: number
  skillLevel?: string
  position?: string
  championship?: string
  xp?: number
  coins?: number
  elo?: number
}
```

### **API Routes Next.js**
- **POST `/api/auth/login`**: Authentification SHA256
- **POST `/api/auth/register`**: Inscription utilisateur
- Futur: `/api/games`, `/api/rankings`, `/api/players`

## âš™ï¸ Backend IoT - Flask + Arduino

### **Flask Server** (`app/app.py`)
- **Port**: 5000
- **WebSocket**: Socket.io pour temps rÃ©el
- **Serial**: Communication Arduino via `/dev/ttyACM0`
- **Routes**: 
  - `GET /`: Interface HTML score
  - `POST /reset`: Reset scores
  - `WebSocket 'connect'`: Sync score initial

### **Score Management**
```python
score = {'GAUCHE': 0, 'DROITE': 0}  # Ã‰tat global

def emit_score():
    socketio.emit('score_update', {
        'left': score['GAUCHE'],
        'right': score['DROITE']
    })
```

### **Arduino Code** (`arduino/babylink/babylink.ino`)
- **Pins**: 2 (gauche), 3 (droite), 5 (buzzer)
- **Logic**: INPUT_PULLUP, dÃ©tection LOWâ†’HIGH
- **Serial**: 9600 baud, envoi "GAUCHE"/"DROITE"
- **Sound**: Buzzer 1000Hz, 150ms

### **Hardware Setup**
- Capteurs IR Adafruit
- Arduino Uno/Nano
- Buzzer actif
- Raspberry Pi (serveur Flask)

## ğŸ¨ Design System

### **Palette de Couleurs**
```css
:root {
  --primary-dark: #0C0E14;    /* Background principal */
  --accent-red: #EA1846;      /* CTA, highlights */
  --text-white: #FDFFFF;      /* Texte principal */
  --light-bg: #F7F7F7;        /* Backgrounds secondaires */
}
```

### **Fonts CSS Variables**
```css
--font-ibm-plex-sans: 'IBM Plex Sans', sans-serif;
--font-nubernext: 'NuberNext', sans-serif;  
--font-monument: 'Monument Extended', sans-serif;
```

### **Layout Responsive**
- **Desktop**: Sidebar 280px fixe + main content
- **Mobile**: Sidebar overlay + burger menu
- **CSS Grid**: `grid-rows-[auto_1fr_auto]` pour footer fixe

## ğŸš€ Scripts & Commandes

### **Frontend (Node.js)**
```bash
cd frontend/
npm run dev          # Dev server (port 3000)
npm run build        # Production build
npm run lint         # ESLint
npx prisma db push   # Sync schema â†’ database
npx prisma db seed   # Populate test data
npx prisma generate  # Generate client types
```

### **Backend IoT (Python)**
```bash
cd app/
python3 app.py       # Flask server (port 5000)
# PrÃ©requis: Arduino connectÃ© sur /dev/ttyACM0
```

## ğŸ”§ Configuration Files

### **Dependencies Management**
- **Frontend**: `frontend/package.json` (48 dÃ©pendances)
- **Backend**: `requirements.txt` (4 dÃ©pendances Python)

### **TypeScript Config**
- `frontend/tsconfig.json`: Strict mode, path mapping
- **ESLint**: `frontend/eslint.config.mjs` + `.eslintignore`

### **Tailwind Setup**
- `frontend/tailwind.config.ts`: CSS variables, fonts
- `frontend/postcss.config.mjs`: PostCSS 4

## ğŸ“¡ Real-time Communication

### **Socket.io Flow**
```
Arduino â†’ Serial â†’ Flask â†’ Socket.io â†’ Frontend
  â†“          â†“        â†“         â†“         â†“
"GAUCHE"  â†’  +1   â†’  emit   â†’  event  â†’  UI update
```

### **Event Types**
- `score_update`: Envoi score temps rÃ©el
- `connect`: Client connection (sync initial)

## ğŸ”’ Security & Auth

### **Password Hashing**
```typescript
// MÃªme logique partout (seed, login, register)
function hashPassword(password: string): string {
  return createHash('sha256').update(password).digest('hex')
}
```

### **Session Management**
- **Storage**: localStorage (frontend only)
- **Validation**: API routes vÃ©rifient hash
- **Redirect**: Auto-redirect si non connectÃ©

## ğŸ¯ Features Actuelles vs Futures

### **âœ… ImplÃ©mentÃ©**
- Authentification utilisateur
- Dashboard responsive  
- Sidebar navigation
- Score temps rÃ©el Arduinoâ†’Flask
- Design system complet

### **ğŸš§ En DÃ©veloppement**
- Profils utilisateur complets
- SystÃ¨me de matchs
- Rankings/Classements
- RÃ©servation tables
- SystÃ¨me de coins/paris
- Clans/Ã©quipes

## ğŸ“± Responsive Design

### **Breakpoints**
- `lg:`: Desktop (1024px+) - Sidebar fixe
- `max-lg:`: Mobile/Tablet - Sidebar overlay

### **Layout Strategy**
- **CSS Grid**: Layout principal
- **Flexbox**: Composants internes
- **Tailwind**: Utility-first approach

Cette architecture permet une Ã©volutivitÃ© maximale vers les fonctionnalitÃ©s futures tout en maintenant une base solide IoT + Web.
